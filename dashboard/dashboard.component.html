<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header" *ngIf="currentUser$ | async as user">
    <div class="header-content">
      <div class="greeting-section">
        <h1 class="greeting-title">{{ getGreeting() }}, {{ user.nombre }}!</h1>
        <p class="greeting-subtitle">
          <mat-icon>wb_sunny</mat-icon>
          Aquí está un resumen de tu residencia hoy
        </p>
      </div>
      
      <div class="header-actions" *ngIf="isAdmin()">
        <button mat-raised-button color="primary" routerLink="/reports/new">
          <mat-icon>add</mat-icon>
          Crear Reporte
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
  </div>

  <!-- Stats Cards Grid -->
  <div class="stats-grid" *ngIf="!isLoading">
    <app-stats-card
      *ngFor="let card of statsCards"
      [title]="card.title"
      [value]="card.value"
      [icon]="card.icon"
      [color]="$any(card.color)"
      [route]="card.route"
      [change]="card.change"
      [changeType]="$any(card.changeType)"
      [prefix]="card.prefix"
    ></app-stats-card>
  </div>

  <!-- Quick Actions -->
  <mat-card class="quick-actions-card" *ngIf="!isLoading">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>flash_on</mat-icon>
        Acciones Rápidas
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="quick-actions-grid">
        <ng-container *ngFor="let action of quickActions">
          <button
            *ngIf="hasAccess(action.roles)"
            mat-raised-button
            [routerLink]="action.route"
            class="quick-action-button"
            [class]="'action-' + action.color"
          >
            <mat-icon>{{ action.icon }}</mat-icon>
            <span>{{ action.label }}</span>
          </button>
        </ng-container>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Main Content Grid -->
  <div class="content-grid" *ngIf="!isLoading">
    <!-- Left Column -->
    <div class="content-column">
      <!-- Pending Reports -->
      <app-pending-reports></app-pending-reports>

      <!-- Chart Card - Payment Trends -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            Tendencia de Pagos
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-placeholder">
            <mat-icon>insert_chart</mat-icon>
            <p>Gráfico de tendencias de pagos mensuales</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Right Column -->
    <div class="content-column">
      <!-- Recent Activities -->
      <app-recent-activities></app-recent-activities>

      <!-- Upcoming Activities Card -->
      <mat-card class="upcoming-activities-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>event</mat-icon>
            Próximas Actividades
          </mat-card-title>
          <button mat-icon-button routerLink="/activities">
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-list">
            <div class="activity-item">
              <div class="activity-icon" style="background: rgba(102, 126, 234, 0.1);">
                <mat-icon style="color: #667eea;">pool</mat-icon>
              </div>
              <div class="activity-details">
                <h4>Mantenimiento de Piscina</h4>
                <p>Mañana, 10:00 AM</p>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon" style="background: rgba(76, 175, 80, 0.1);">
                <mat-icon style="color: #4caf50;">sports_soccer</mat-icon>
              </div>
              <div class="activity-details">
                <h4>Torneo de Fútbol</h4>
                <p>Sábado, 4:00 PM</p>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon" style="background: rgba(255, 152, 0, 0.1);">
                <mat-icon style="color: #ff9800;">meeting_room</mat-icon>
              </div>
              <div class="activity-details">
                <h4>Reunión de Residentes</h4>
                <p>Domingo, 6:00 PM</p>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Bottom Section - Status Overview -->
  <mat-card class="status-overview-card" *ngIf="!isLoading && isAdmin()">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>assessment</mat-icon>
        Estado General del Sistema
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="status-grid">
        <div class="status-item">
          <div class="status-header">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            <span class="status-label">Sistema Operativo</span>
          </div>
          <p class="status-value">100%</p>
        </div>
        
        <div class="status-item">
          <div class="status-header">
            <mat-icon class="status-icon primary">storage</mat-icon>
            <span class="status-label">Uso de Base de Datos</span>
          </div>
          <mat-progress-bar mode="determinate" [value]="65" color="primary"></mat-progress-bar>
          <p class="status-value">65%</p>
        </div>
        
        <div class="status-item">
          <div class="status-header">
            <mat-icon class="status-icon accent">people</mat-icon>
            <span class="status-label">Usuarios Activos</span>
          </div>
          <p class="status-value">{{ statsCards[1].value }} / {{ statsCards[0].value * 4 }}</p>
        </div>
        
        <div class="status-item">
          <div class="status-header">
            <mat-icon class="status-icon warn">notifications_active</mat-icon>
            <span class="status-label">Notificaciones Pendientes</span>
          </div>
          <p class="status-value">{{ statsCards[2].value }}</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>